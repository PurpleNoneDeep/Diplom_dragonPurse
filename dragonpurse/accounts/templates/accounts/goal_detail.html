{% extends "accounts/base.html" %}
{% load static %}
{% block head %}<link rel="stylesheet" href="{% static 'accounts/css/dashboard.css' %}">
<link rel="stylesheet" href="{% static 'accounts/css/theme.css' %}">{% endblock %}
{% block content %}
<div class="sidebar">
        <h1><a href="{% url 'dashboard' %}">DragonPurse</a></h1>
        <a href="{% url 'goals_list' %}"><button>Назад к целям</button></a>
        <div class="line"></div>
        <div style="display: flex; margin: 5px;">
        <a href="{% url 'settings' %}" style="display: flex; margin: 5px;"><img src="{% static 'accounts/img/settings_photo.png' %}" width="30" height="30" alt="настройки"></a>
        <a href="{% url 'logout' %}" style="display: flex; margin: 5px;"><img src="{% static 'accounts/img/exit_photo.png' %}" width="30" height="30" alt="выход"></a>
        </div>

    </div>
<main>
<h1>{{ goal.name }}</h1>

<p><strong>Описание:</strong> {{ goal.description }}</p>
<p><strong>Дедлайн:</strong> {{ goal.deadline }}</p>
<p><strong>Статус:</strong> {{ goal.get_status_display }}</p>

<h3>Прогресс накопления:</h3>
<div style="width:100%; background-color:#eee; border-radius:10px; height:25px;">
  <div style="width:{{ percent }}%; background-color:#4caf50; height:100%; border-radius:10px; color:white; text-align:center; line-height:25px;">
    {{ percent }}%
  </div>
</div>
<p><strong>Накоплено:</strong> {{ total_saved|floatformat:2 }} BYN из {{ total_goal_amount|floatformat:2 }} BYN</p>

<hr>

<h3>Участники</h3>
<table border="1" cellpadding="8" style="border-collapse:collapse;">
  <thead>
    <tr>
      <th>Пользователь</th>
      <th>Целевая сумма</th>
    </tr>
  </thead>
  <tbody>
    {% for p in participants %}
    <tr>
      <td>{{ p.user.username }} ({{ p.user.email }})</td>
      <td>{{ p.amount|floatformat:2 }} BYN</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<hr>

<h3>Транзакции</h3>
<table border="1" cellpadding="8" style="border-collapse:collapse;">
  <thead>
    <tr>
      <th>Дата</th>
      <th>Пользователь</th>
      <th>Категория</th>
      <th>Описание</th>
      <th>Сумма</th>
    </tr>
  </thead>
  <tbody>
    {% for t in transactions %}
    <tr>
      <td>{{ t.date|date:"d.m.Y H:i" }}</td>
      <td>{{ t.user.username }}</td>
      <td>{% if t.category %}
    {{ t.category.name }}
{% else %}
    Без категории
{% endif %}</td>
      <td>{{ t.description }}</td>
      <td>{{ t.goal_amount|floatformat:2 }} BYN</td>
    </tr>
    {% empty %}
    <tr>
      <td colspan="5" style="text-align:center;">Пока нет транзакций</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
</main>
{% endblock %}
